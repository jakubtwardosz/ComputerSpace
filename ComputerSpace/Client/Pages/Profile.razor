@page "/profile"
@inject IAuthService AuthService
@attribute [Authorize]

<MudContainer Class="mt-16" MaxWidth="MaxWidth.Medium">
    <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true">Profile</MudText>
    <AuthorizeView>
        <MudText Align="Align.Center">Hi! You're logged in with <i>@context.User.Identity.Name</i></MudText>
    </AuthorizeView>

    <MudGrid Spacing="6" Class="mt-16">
        <MudItem xs="12">
            <MudText Typo="Typo.h5" GutterBottom="true">Delivery Address</MudText>
            <AddressForm />
        </MudItem>

        <MudItem xs="12">
            <MudText Typo="Typo.h5" GutterBottom="true">Change Password</MudText>
            <EditForm Model="request" OnValidSubmit="ChangePassword">
                <DataAnnotationsValidator></DataAnnotationsValidator>

                    <MudItem xs="12">
                        <MudTextField @bind-Value="request.Password" Label="New password" Variant="Variant.Text" InputType="InputType.Password" />
                        <ValidationMessage For="@(() => request.Password)" />
                    </MudItem>

                    <MudItem xs="12">
                        <MudTextField @bind-Value="request.ConfirmPassword" Label="Confirm New Password" Variant="Variant.Text" InputType="InputType.Password" />
                        <ValidationMessage For="@(() => request.ConfirmPassword)" />
                    </MudItem>

                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" DisableElevation="true" Color="Color.Primary" Size="Size.Large" Class="mt-8">Apply</MudButton>
                    </MudItem>
            </EditForm>
        </MudItem>
    </MudGrid>
</MudContainer>

@message

@code {
    UserChangePassword request = new UserChangePassword();
    string message = string.Empty;
    
    private async Task ChangePassword()
    {
        var result = await AuthService.ChangePassword(request);
        message = result.Message;
    }   

}
